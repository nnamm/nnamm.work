<!DOCTYPE html>

<html lang="ja">
<head>
<title>PythonとAutomatorでブログ執筆ツールをつくりました｜nnamm.work</title>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Pelican" name="generator"/>
<meta content="652239472256159" name="fb:app_id"/>
<meta content="summary_large_image" name="twitter:card"/>
<meta content="@nnammg" name="twitter:site"/>
<meta content="uAnciPeNieWUtkryWWqFeQkRqIkEEzUX7h4A8bSliWY" name="google-site-verification"/>
<meta content="PythonとAutomatorでブログ執筆ツールをつくりました" property="og:title"/>
<meta content="article" property="og:type"/>
<meta content="/posts/002-startup-blog-writing-env/" property="og:url"/>
<meta content="https://nnamm.work/images/posts/002_200329-0.jpg" property="og:image"/>
<meta content="nnamm.work" property="og:site_name"/>
<meta content="楽しみながら開発。macOSはカスタムできることが多くて便利。" property="og:description"/>
<link href="/favicon.ico" rel="shortcut icon"/>
<link href="/apple-touch-icon.png" rel="apple-touch-icon"/>
<link href="/android-chrome-192x192.png" rel="icon" type="image/png"/>
<link href="/theme/css/styles.min.css" rel="stylesheet"/>
<link href="/theme/css/pygments.min.css" rel="stylesheet"/>
</head>
<body>
<header><nav class="flex justify-between items-center inset-x-0 top-0 bg-white border-b border-gray-200">
<a class="inline-flex text-lg font-semibold tracking-wider hover:text-pink-400 transition-colors m-4 pl-2 md:pl-4 lg:pl-8" href="/">
    nnamm.work
  </a>
<button class="pr-4 py-3 focus:outline-none md:hidden" id="mobileMenuButton" title="Open side menu">
<svg class="w-6 h-6 hidden" fill="none" id="mobileMenuButtonClose" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M6 18L18 6M6 6l12 12" stroke-linejoin="round" stroke-width="2"></path>
</svg>
<svg class="w-6 h-6" fill="none" id="mobileMenuButtonOpen" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
<div class="flex flex-col md:flex-row md:items-center absolute top-0 right-0 z-10 bg-white rounded-bl-md md:bg-opacity-0 transition-all duration-500 transform translate-x-0 -translate-y-full md:translate-y-0 w-1/2 md:w-auto px-3 md:px-0 md:mt-2.5 ld:mt-3 md:mx-1 md:pr-8 lg:pr-12" id="sideMenuHideOnMobile">
<a class="text-sm md:ml-6 lg:ml-10 my-2 py-1 border-b border-transparent hover:border-pink-400 hover:text-pink-400 transition-colors duration-200" href="https://thanamura.tumblr.com" target="_blank">
        Portfolio -private-
      </a>
<a class="text-sm md:ml-6 lg:ml-10 my-2 py-1 border-b border-transparent hover:border-pink-400 hover:text-pink-400 transition-colors duration-200" href="https://thanamura-portrait.tumblr.com" target="_blank">
        Portfolio -works-
      </a>
<a class="text-sm md:ml-6 lg:ml-10 my-2 py-1 border-b border-transparent hover:border-pink-400 hover:text-pink-400 transition-colors duration-200" href="https://note.com/tnnamm/m/m2aa9550047ed" target="_blank">
        Stock Photo
      </a>
<a class="text-sm md:ml-6 lg:ml-10 my-2 py-1 border-b border-transparent hover:border-pink-400 hover:text-pink-400 transition-colors duration-200" href="http://localhost:8000/pages/about" target="_self">
        About
      </a>
<a class="text-sm md:ml-6 lg:ml-10 my-2 py-1 border-b border-transparent hover:border-pink-400 hover:text-pink-400 transition-colors duration-200" href="http://localhost:8000/pages/privacy-policy" target="_self">
        Privacy Policy
      </a>
</div>
</nav></header>
<article>
<header class="flex flex-col pt-12 md:pt-20 pb-12">
<h1 class="palt text-2xl md:text-3xl font-semibold w-full md:max-w-3xl md:mx-auto px-4 md:px-10 mb-4">
        PythonとAutomatorでブログ執筆ツールをつくりました</h1>
<div class="flex items-center w-full md:max-w-3xl md:mx-auto px-4 md:px-10 mb-10">
<img alt="Profile image of Takashi Hanamura" class="image-process-crisp w-10 md:w-12 h-10 md:h-12 rounded-full mr-2 md:mr-4" loading="lazy" src="/images/derivatives/crisp/1x/profile_small.jpg" srcset="/images/derivatives/crisp/1x/profile_small.jpg 1x, /images/derivatives/crisp/2x/profile_small.jpg 2x, /images/derivatives/crisp/3x/profile_small.jpg 3x"/>
<div class="text-xs text-gray-500">
<span class="block mb-1">花村貴史 / Takashi Hanamura</span>
<span class="block">
              2021/06/19
              <span>
<svg class="inline-block w-2.5 h-2.5 fill-current text-gray-500" viewbox="100 100 1792 1792" xmlns="http://www.w3.org/2000/svg">
<path d="M1639 1056q0 5-1 7-64 268-268 434.5t-478 166.5q-146 0-282.5-55t-243.5-157l-129 129q-19 19-45 19t-45-19-19-45v-448q0-26 19-45t45-19h448q26 0 45 19t19 45-19 45l-137 137q71 66 161 102t187 36q134 0 250-65t186-179q11-17 53-117 8-23 30-23h192q13 0 22.5 9.5t9.5 22.5zm25-800v448q0 26-19 45t-45 19h-448q-26 0-45-19t-19-45 19-45l138-138q-148-137-349-137-134 0-250 65t-186 179q-11 17-53 117-8 23-30 23h-199q-13 0-22.5-9.5t-9.5-22.5v-7q65-268 270-434.5t480-166.5q146 0 284 55.5t245 156.5l130-129q19-19 45-19t45 19 19 45z"></path>
</svg>
</span>
            2020/03/29
          </span>
</div>
</div>
<img alt="Eye catching image for this article" class="image-process-default w-full max-w-full md:max-w-4xl lg:max-w-5xl md:mx-auto md:rounded" loading="lazy" src="../../images/posts/derivatives/default/1x/002_200329-0.jpg" srcset="../../images/posts/derivatives/default/1x/002_200329-0.jpg 1x, ../../images/posts/derivatives/default/2x/002_200329-0.jpg 2x, ../../images/posts/derivatives/default/3x/002_200329-0.jpg 3x"/>
</header>
<div class="hidden xl:flex xl:justify-center xl:sticky xl:top-4">
<div class="profile-box w-full max-w-screen-xl pointer-events-none">
<div class="flex flex-col items-center mx-auto absolute w-56 mt-12 ml-3 pointer-events-auto">
<img alt="Profile image of Takashi Hanamura" class="image-process-crisp w-32 h-32 rounded-full mb-6" loading="lazy" src="/images/derivatives/crisp/1x/profile_large_old.jpg" srcset="/images/derivatives/crisp/1x/profile_large_old.jpg 1x, /images/derivatives/crisp/2x/profile_large_old.jpg 2x, /images/derivatives/crisp/3x/profile_large_old.jpg 3x"/>
<p class="text-sm leading-relaxed font-semibold mb-2">花村貴史 / Takashi Hanamura</p>
<p class="text-xs leading-relaxed text-gray-500 mb-4">ソフトウェアエンジニア＆空気感フォトグラファー。オシゴトは SAP ですが、プライベートでは Python/Golang/TS/JS 周辺を嗜みつつ、人や場の「空気感」をそっとすくい撮ることを得意としています。</p>
<hr class="w-full mb-4"/>
<div class="flex">
<a href="https://nnamm.com" target="_blank">
<svg class="aside-external-link mr-4" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M2.597 7.81l4.911 13.454c-3.434-1.668-5.802-.19-5.802-9.264 0-1.493.32-2.91.891-4.19zm16.352 3.67c0-1.272-.457-2.153-.849-2.839-.521-.849-1.011-1.566-1.011-2.415 0-.978.747-1.88 1.862-1.819-1.831-1.677-4.271-2.701-6.951-2.701-3.596 0-6.76 1.845-8.601 4.64.625.02 1.489.032 3.406-.118.555-.034.62.782.066.847 0 0-.558.065-1.178.098l3.749 11.15 2.253-6.756-1.604-4.394c-.555-.033-1.08-.098-1.08-.098-.555-.033-.49-.881.065-.848 2.212.17 3.271.171 5.455 0 .555-.033.621.783.066.848 0 0-.559.065-1.178.098l3.72 11.065 1.027-3.431c.444-1.423.783-2.446.783-3.327zm-6.768 1.42l-3.089 8.975c.922.271 1.898.419 2.908.419 1.199 0 2.349-.207 3.418-.583-.086-.139-3.181-8.657-3.237-8.811zm8.852-5.839c.224 1.651-.099 3.208-.713 4.746l-3.145 9.091c3.061-1.784 5.119-5.1 5.119-8.898 0-1.79-.457-3.473-1.261-4.939zm2.967 4.939c0 6.617-5.384 12-12 12s-12-5.383-12-12 5.383-12 12-12 12 5.383 12 12zm-.55 0c0-6.313-5.137-11.45-11.45-11.45s-11.45 5.137-11.45 11.45 5.137 11.45 11.45 11.45 11.45-5.137 11.45-11.45z"></path>
</svg>
</a>
<a href="https://www.facebook.com/t.hanamura.photography/" target="_blank">
<svg class="aside-external-link mr-4" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"></path>
</svg>
</a>
<a href="https://twitter.com/nnammg" target="_blank">
<svg class="aside-external-link mr-4" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z">
</path>
</svg>
</a>
<a href="https://github.com/nnamm" target="_blank">
<svg class="aside-external-link mr-4" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
</svg>
</a>
<a href="https://www.youtube.com/channel/UCvXy78MlFBKnNDMcSrqnOnA" target="_blank">
<svg class="aside-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path>
</svg>
</a>
</div>
</div>
</div>
</div> <div class="entry-content w-full md:max-w-3xl md:mx-auto px-4 md:px-10">
<p>静的サイトジェネレーター（ SSG ）で作ったサイトの記事は Markdown ファイルで管理します。</p>
<p>WordPress でいう Title、Date、Description、Category、tags などの設定もできて、ファイルの冒頭に Front matter と呼ばれるデータを書きこむことで、SSG がよしなに判断してあれこれしてくれます。</p>
<p>ただ、記事を書くたびに</p>
<ul>
<li>ファイルを作成</li>
<li>Front matter （定型文）をコピペ</li>
<li>タイトルや日付などを入力</li>
</ul>
<p>するのは手間がかかるので macOS の Automator を使ってツールを 2 つ作りました。</p>
<ol>
<li>Markdown ファイルを作り、任意のエディタを起動するアプリ</li>
<li>gridsome develop を起動し、指定のブラウザで localhost に接続するショートカットキー</li>
</ol>
<p>この記事では Python や Automator をどのように使ったかをまとめます。</p>
<blockquote>
<p>2021 年 6 月現在、SSG を Gridsome から Pelican に変更しました。Front 
matter の中身も変わったため、掲載している内容やスクリプトが現在とは若干異なっています。でも、本筋は変わっていませんので参考になるかと思います。 </p>
</blockquote>
<h2 id="1-markdown">1. Markdown ファイルを作り、任意のエディタを起動するアプリ</h2>
<p>※記事の最後にソースコードを載せました。参考にどうぞ。</p>
<h3 id="pythonmarkdown">Python で Markdown ファイルを作る</h3>
<p>僕のサイトでは以下のように記事ファイルと画像ファイルを配置しています。</p>
<div class="highlight"><pre><span></span><code>/static/posts/blog/
                 <span class="p">|</span>
                 <span class="p">|</span>__001/
                 <span class="p">|</span>    <span class="p">|</span>__img/
                 <span class="p">|</span>    <span class="p">|</span>__001_200322.md
                 <span class="p">|</span>
                 <span class="p">|</span>__002
                 <span class="p">|</span>    <span class="p">|</span>__img/
                 <span class="p">|</span>    <span class="p">|</span>__002_YYMMDD.md
                 <span class="p">|</span>
                （以降、003、004と記事ごとに増えていく）
</code></pre></div>
<p>「ディレクトリ名が 1 つずつ加算されている」部分やファイル名の「YYMMDD」などがプログラミングの使い所。</p>
<p>ディレクトリやファイル操作をすればいいので Pathlib モジュールを使います。パスをオブジェクトとして操作できるようになります。 </p>
<p>参考：<a href="https://docs.python.org/ja/3/library/pathlib.html" target="_blank">pathlib --- オブジェクト指向のファイルシステムパス</a></p>
<p>次は Front matter です。</p>
<p>これは以下のようなデータ群になってます。「$」ではじまっている変数はスクリプトを実行するたびに設定します。これを毎回コピペするのはすっごく面倒なのでここでもプログラミングの力を使いましょう。</p>
<div class="highlight"><pre><span></span><code>---
title:
date: <span class="nv">$date</span>
createdAt: <span class="nv">$date</span>
updatedAt: <span class="nv">$date</span>
description:
image: <span class="nv">$image</span>
slug: <span class="nv">$slug</span>
category:
tags:
type: <span class="nv">$type</span>
---
</code></pre></div>
<p>「$」は定型文や動的にテキストデータを設定するところなので、String モジュールの template を使います。</p>
<p>参考：<a href="https://docs.python.org/ja/3/library/string.html" target="_blank">string --- 一般的な文字列操作</a></p>
<p>使い方はかんたんで、Front matter の定義ファイルを開いて、substitute()で$変数に値を入れる。それを Markdown ファイルに write()で OK です。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># gen_md_file.py（一部抜粋）</span>

<span class="kn">import</span> <span class="nn">string</span>

<span class="n">md_full_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">s_date</span><span class="si">}</span><span class="s2">.md"</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"template/front_matter.txt"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fm</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">l_date</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">post_type</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">md_full_path</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_md</span><span class="p">:</span>
        <span class="n">new_md</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
</code></pre></div>
<h3 id="automator">Automator からスクリプトを実行してエディタを起動する</h3>
<p>スクリプトは作れたけど、新しく記事を書くたびに python コマンドを叩くのは手間です。それにどうせなら Markdown ファイルを開いてすぐブログを書きはじめられたら素敵じゃないですか。</p>
<p>そんなときは Automator にシェルコマンドを入力してもらいましょう。</p>
<p>Automator を起動して「アプリケーション」を選択。</p>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-1.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-1.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-1.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-1.jpg 3x"/></p>
<p>Automator で Python を実行するには、シェルから実行してもらうようにしないといけません。以下の順番でつなげていきます。</p>
<ol>
<li>シェルスクリプトを実行</li>
<li>指定された Finder 項目を取得</li>
<li>Finder 項目を開く(お好きなアプリを選択)</li>
</ol>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-2.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-2.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-2.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-2.jpg 3x"/></p>
<p>シェル実行時に Markdown ファイルの絶対パスを print()で出力しています。それが「指定された Finder 項目を取得」につながって、次の「Finder 項目を開く」へとつながっていきます。</p>
<p>さらに、どうせなら Automator で作ったアプリのアイコンも変えましょう。</p>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-3.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-3.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-3.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-3.jpg 3x"/></p>
<p>まず、Automator で作たアプリの情報ウィンドウを表示させます。次に左上のアイコンを選択状態にしてから、あらかじめクリップボードにコピーしておいた画像を command+v してあげれば OK です。</p>
<h2 id="2-gridsome-developlocalhost">2. gridsome develop を起動し、指定のブラウザで localhost に接続するショートカットキー</h2>
<p>記事を書きながらプレビューできたら便利ですよね。今回はショートカットキーで起動するようにします。</p>
<p>Automator を起動して「クイックアクション」を選択。</p>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-4.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-4.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-4.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-4.jpg 3x"/></p>
<p>以下の順でつなげていきます。</p>
<ol>
<li>指定された Finder 項目を取得（後述のコマンドファイルを指定）</li>
<li>Finder 項目を開く</li>
<li>一時停止（ビルドにちょっと時間がかかるため一休み）</li>
<li>シェルスクリプトを実行（ブラウザのフルパス + URL ）</li>
</ol>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-5.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-5.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-5.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-5.jpg 3x"/></p>
<h3 id="_1">コマンドファイル</h3>
<p>「シェルスクリプトを実行」から直接 gridsome develop をすると、ctrl+c で Gridsome のプロセスを停止できません。僕から見えない誰かがプロセスを握ってしまっているためだと思います。</p>
<p>なので、以下のコマンドファイルを作り、Terminal を起動してから実行してあげる必要があります。</p>
<div class="highlight"><pre><span></span><code>$ touch _start_gridsome.command
$ vim _start_gridsome.command

<span class="nb">cd</span> ~/Develop/MyProject/gridsome_nnamm/
gridsome develop
</code></pre></div>
<p>実行権限をつけるのを忘れずに。</p>
<div class="highlight"><pre><span></span><code>$ chmod a+x _start_gridsome.command
</code></pre></div>
<h3 id="_2">ショートカットキーの設定</h3>
<p>クイックアクションは macOS のサービスとして扱われるため、システム環境設定から任意のショートカットキーを割り当ててあげましょう。</p>
<p><img alt="" class="image-process-crisp" loading="lazy" src="../../images/posts/derivatives/crisp/1x/002_200329-6.jpg" srcset="../../images/posts/derivatives/crisp/1x/002_200329-6.jpg 1x, ../../images/posts/derivatives/crisp/2x/002_200329-6.jpg 2x, ../../images/posts/derivatives/crisp/3x/002_200329-6.jpg 3x"/></p>
<p>以上で完成です。</p>
<h2 id="_3">おわりに</h2>
<p>これで、アプリアイコンをダブルクリックするだけでブログが書けるようになりました。また、必要に応じてショートカットキーでプレビュー画面を起動するということもできました。</p>
<p>大満足！</p>
<h2 id="gen_md_filepy">参考： gen_md_file.py</h2>
<div class="highlight"><pre><span></span><code><span class="sd">"""</span>
<span class="sd">新規ブログ記事の雛形Markdownファイルを作るスクリプト</span>
<span class="sd">所定のディレクトリに、以下のディレクトリを作成する</span>
<span class="sd">...blog/</span>
<span class="sd">      |__001</span>
<span class="sd">           |_img/</span>
<span class="sd">           |_001_YYMMDD.md（フロントマター含）</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">string</span>


<span class="k">def</span> <span class="nf">create_front_matter_info</span><span class="p">(</span><span class="n">work_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">""" フロントマター用のデータを作成する</span>
<span class="sd">    Args:</span>
<span class="sd">        work_dir: 所定のディレクトリパス</span>
<span class="sd">    Returns:</span>
<span class="sd">        dict: フロントマターに設定する情報</span>
<span class="sd">    """</span>

    <span class="n">fm_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"new_dir_name"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># 新記事を格納するディレクトリ名（作業用）</span>
        <span class="s2">"new_dir_path"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># 上記を含めたフルパス</span>
        <span class="s2">"created_date_long"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># 記事作成日時ロング版（スクリプト実行日時）</span>
        <span class="s2">"created_date_short"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># 上記のショート版</span>
        <span class="s2">"eye_path"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># アイキャッチの画像のパス</span>
        <span class="s2">"slug_str"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>  <span class="c1"># スラッグ</span>
        <span class="s2">"post_type"</span><span class="p">:</span> <span class="s2">"blog"</span><span class="p">,</span>  <span class="c1"># ポストタイプはblog</span>
    <span class="p">}</span>

    <span class="c1"># 新記事のディレクトリ名（ゼロパディング）とフルバス</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
    <span class="n">dir_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">latest_dir</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dir_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"new_dir_name"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">latest_dir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"new_dir_path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">work_dir</span> <span class="o">+</span> <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"new_dir_name"</span><span class="p">]</span>

    <span class="c1"># 新記事の作成日時（long: YYYY-MM-DD HH:MM:SS / short: YYYYMMDD）</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">)</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"created_date_long"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"created_date_short"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>

    <span class="c1"># アイキャッチの画像パス</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"eye_path"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'/ec/blog/ec_blog_</span><span class="si">{</span><span class="n">fm_dict</span><span class="p">[</span><span class="s2">"new_dir_name"</span><span class="p">]</span><span class="si">}</span><span class="s1">.jpg'</span>

    <span class="c1"># スラッグ</span>
    <span class="n">fm_dict</span><span class="p">[</span><span class="s2">"slug_str"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">fm_dict</span><span class="p">[</span><span class="s2">"new_dir_name"</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">fm_dict</span><span class="p">[</span><span class="s2">"created_date_short"</span><span class="p">]</span><span class="si">}</span><span class="s1">-'</span>

    <span class="k">return</span> <span class="n">fm_dict</span>


<span class="k">def</span> <span class="nf">generate_blog_file</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">""" 新記事のディレクトリとファイルを作成する</span>
<span class="sd">    Args:</span>
<span class="sd">        params: フロントマターに設定する情報</span>
<span class="sd">    """</span>

    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"new_dir_name"</span><span class="p">]</span>
    <span class="n">dir_path</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"new_dir_path"</span><span class="p">]</span>
    <span class="n">l_date</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"created_date_long"</span><span class="p">]</span>
    <span class="n">s_date</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"created_date_short"</span><span class="p">]</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"eye_path"</span><span class="p">]</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"slug_str"</span><span class="p">]</span>
    <span class="n">post_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"post_type"</span><span class="p">]</span>

    <span class="c1"># ディレクトリを作成</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s2">"/img/"</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># mdファイルにテンプレートからフロントマターを設定</span>
    <span class="n">md_full_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">s_date</span><span class="si">}</span><span class="s2">.md"</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"template/front_matter.txt"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fm</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">l_date</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img_path</span><span class="p">,</span> <span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">post_type</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">md_full_path</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_md</span><span class="p">:</span>
            <span class="n">new_md</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

    <span class="c1"># macOSのAutomatorと連携するために引数としてファイルパスを出力</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">md_full_path</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"config.ini"</span><span class="p">)</span>
    <span class="n">blog_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">"path"</span><span class="p">][</span><span class="s2">"blog"</span><span class="p">]</span>

    <span class="n">generate_blog_file</span><span class="p">(</span><span class="n">create_front_matter_info</span><span class="p">(</span><span class="n">blog_path</span><span class="p">))</span>
</code></pre></div>
<p>▶︎ 最新版は<a href="https://github.com/nnamm/md-generator" target="_blank">GitHub</a></p>
<p>※勉強がてら flake8/pylint/black を PyCharm に導入してみました。pytest もやってみようと思います。</p>
</div>
<div class="w-full md:max-w-3xl md:mx-auto mt-12 mb-20 px-4 md:px-10">
<div>
<svg class="inline-block w-4 h-4 fill-current text-gray-700 py-0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M11 5c-1.629 0-2.305-1.058-4-3h-7v20h24v-17h-13z"></path>
</svg>
<a class="metadata-category-link inline-block mr-2" href="/category/creative.html">
    Creative
  </a>
<div class="inline md:hidden"><br/></div>
<svg class="inline-block w-4 h-4 fill-current text-gray-700 py-0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M10.605 0h-10.605v10.609l13.391 13.391 10.609-10.604-13.395-13.396zm-4.191 6.414c-.781.781-2.046.781-2.829.001-.781-.783-.781-2.048 0-2.829.782-.782 2.048-.781 2.829-.001.782.782.781 2.047 0 2.829z"></path>
</svg>
<a class="metadata-tags-link inline-block" href="/tag/macos.html">
      macOS
    </a>
<a class="metadata-tags-link inline-block" href="/tag/python.html">
      Python
    </a>
</div> </div>
</article>
<footer><div class="flex flex-col justify-center items-center bg-white border-t border-gray-200 mt-8 pt-12 pb-8">
<div class="flex flex-row justify-evenly w-7/12 md:w-4/12 mb-8">
<a href="https://nnamm.com" target="_blank">
<svg class="footer-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M2.597 7.81l4.911 13.454c-3.434-1.668-5.802-.19-5.802-9.264 0-1.493.32-2.91.891-4.19zm16.352 3.67c0-1.272-.457-2.153-.849-2.839-.521-.849-1.011-1.566-1.011-2.415 0-.978.747-1.88 1.862-1.819-1.831-1.677-4.271-2.701-6.951-2.701-3.596 0-6.76 1.845-8.601 4.64.625.02 1.489.032 3.406-.118.555-.034.62.782.066.847 0 0-.558.065-1.178.098l3.749 11.15 2.253-6.756-1.604-4.394c-.555-.033-1.08-.098-1.08-.098-.555-.033-.49-.881.065-.848 2.212.17 3.271.171 5.455 0 .555-.033.621.783.066.848 0 0-.559.065-1.178.098l3.72 11.065 1.027-3.431c.444-1.423.783-2.446.783-3.327zm-6.768 1.42l-3.089 8.975c.922.271 1.898.419 2.908.419 1.199 0 2.349-.207 3.418-.583-.086-.139-3.181-8.657-3.237-8.811zm8.852-5.839c.224 1.651-.099 3.208-.713 4.746l-3.145 9.091c3.061-1.784 5.119-5.1 5.119-8.898 0-1.79-.457-3.473-1.261-4.939zm2.967 4.939c0 6.617-5.384 12-12 12s-12-5.383-12-12 5.383-12 12-12 12 5.383 12 12zm-.55 0c0-6.313-5.137-11.45-11.45-11.45s-11.45 5.137-11.45 11.45 5.137 11.45 11.45 11.45 11.45-5.137 11.45-11.45z"></path>
</svg>
</a>
<a href="https://www.facebook.com/t.hanamura.photography/" target="_blank">
<svg class="footer-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"></path>
</svg>
</a>
<a href="https://twitter.com/nnammg" target="_blank">
<svg class="footer-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z">
</path>
</svg>
</a>
<a href="https://github.com/nnamm" target="_blank">
<svg class="footer-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
</svg>
</a>
<a href="https://www.youtube.com/channel/UCvXy78MlFBKnNDMcSrqnOnA" target="_blank">
<svg class="footer-external-link" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path>
</svg>
</a>
</div>
<div class="flex flex-col text-center">
<address class="text-xs not-italic mb-2">
      Powered by <a class="underline" href="https://getpelican.com/" target="_blank">Pelican</a>,
      which takes great advantage of <a class="underline" href="https://www.python.org/" target="_blank">Python</a>.
    </address>
<small><a class="hover:text-pink-400 transition-colors" href="/">nnamm.work</a> ©2020</small>
</div>
</div></footer>
<script>
  let mobileMenuButton = document.getElementById('mobileMenuButton')
  mobileMenuButton.onclick = function () {
    document.getElementById('sideMenuHideOnMobile').classList.toggle('-translate-y-full')
    document.getElementById('sideMenuHideOnMobile').classList.toggle('mt-12')
    document.getElementById('sideMenuHideOnMobile').classList.toggle('shadow')
    document.getElementById('mobileMenuButtonClose').classList.toggle('hidden')
    document.getElementById('mobileMenuButtonOpen').classList.toggle('hidden')
  }
  // Hide element when click outside nav
  let theElementContainer = document.getElementsByTagName('nav')[0]
  document.addEventListener('click', function (event) {
    if (!theElementContainer.contains(event.target)) {
      document.getElementById('sideMenuHideOnMobile').classList.add('-translate-y-full')
      document.getElementById('sideMenuHideOnMobile').classList.remove('mt-12')
      document.getElementById('sideMenuHideOnMobile').classList.remove('shadow')
      document.getElementById('mobileMenuButtonOpen').classList.remove('hidden')
      document.getElementById('mobileMenuButtonClose').classList.add('hidden')
    }
  })
</script>
<script>
  window.addEventListener('load', () => {
    viewSlide('.slideshow img')
  })

  function viewSlide(className, slideNo = -1) {
    let imgArray = document.querySelectorAll(className)
    if (imgArray.length) {
      if (slideNo >= 0) {
        imgArray[slideNo].style.opacity = '0'
      }
      slideNo++
      if (slideNo >= imgArray.length) {
        slideNo = 0
      }
      imgArray[slideNo].style.opacity = '1'
      let msec = 5000
      setTimeout(() => {
        viewSlide(className, slideNo)
      }, msec)
    }
  }
</script>
<script>
  let scrollAnimationElm = document.querySelectorAll('.profile-box')
  let scrollAnimationFunc = () => {
    for (let i = 0; i < scrollAnimationElm.length; i++) {
      let triggerMargin = 600
      if (window.innerHeight > scrollAnimationElm[i].getBoundingClientRect().top + triggerMargin) {
        scrollAnimationElm[i].classList.add('show')
      }
    }
  }
  window.addEventListener('load', scrollAnimationFunc)
  window.addEventListener('scroll', scrollAnimationFunc)
</script>
</body>
</html>